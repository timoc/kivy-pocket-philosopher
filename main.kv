#:kivy 1.8.0
#:import main main
#:import get_random_color kivy.utils.get_random_color
#:import ListItemButton kivy.uix.listview.ListItemButton
#:import ListAdapter kivy.adapters.listadapter.ListAdapter

# DEBUG WIDGETS
#<Widget>:
#    canvas.after:
#        Line:
#            rectangle: self.x+1, self.y+1, self.width-1, self.height-1
#            dash_offset: 5
#            dash_length: 3

# DEBUG A WIDGET
#            canvas.after:
#                Color:
#                    rgba: 1, 0, 0, 0.5
#                Line:
#                    rectangle: self.x+1, self.y+1, self.width-1, self.height-1
#                Color:
#                    rgba: 0, 0, 1, 0.3
#                Rectangle:
#                    pos: self.pos
#                    size: self.size

<MainActionBar@ActionBar>
    pos_hint: {'top':1}
    ActionView:
        use_separator: True
        ActionPrevious:
            with_previous: False
        ActionOverflow:
            ActionButton:
                text: "Help"
                on_press: root.help_widget()
            ActionButton:
                id: btn_settings
                on_press: app.open_settings()
                text: "Settings"
            ActionButton:
                text: "About"
                on_press: root.about_widget()
            ActionButton:
                on_press: app.stop()
                text: "Exit"

<AphorismWidget@BoxLayout>:
    BoxLayout:
        orientation: "vertical"
        RelativeLayout:
            Image:
                id: background
                width: root.width
                height: root.height
                keep_ratio: True
                allow_stretch: True
                auto_bring_to_front: False
                source: root.pixel
            Scatter:
                size_hint: None, None
                size: quote.size
                Label:
                    id: quote
                    font_size: '20sp'
                    markup: True
                    text: ''
                    text_size: root.width, None
                    size_hint_y: None
                    size: self.texture_size
                    canvas.before:
                        Color:
                            rgba: get_random_color(0.3)
                        Rectangle:
                            pos: self.pos
                            size: self.size

<SearchForm>:
    search_input: search_box
    search_results: search_results_list
    BoxLayout:
        orientation: "vertical"
        BoxLayout:
            size_hint_y: '0.05sp'
            orientation: "horizontal"
            Label:
                size_hint_x: 25
                text: 'Hashtag:'
            TextInput:
                size_hint_x: 60
                id: search_box
                text: ''
            Button:
                size_hint_x: 15
                text: 'Go!'
                on_press: root.search_action(text = search_box.text)
        ListView:
            id: search_results_list
            adapter:
                ListAdapter(
                data = [],
                args_converter = root.args_converter,
                cls = main.SearchResultsButton)

<SearchResultsButton>:
    text: "{}".format(self.aphorism[1])
    height: '40dp'
    size_hint_y: None
    on_press: app.root.aphorism_display_by_id(self.aphorism[0])

<Main>:
    search_results: []
    AnchorLayout:
        anchor_x: 'center'
        anchor_y: 'top'
        ScreenManager:
            size_hint: 1, .9
            id: Screens
            Screen:
                name: 'Main'
                BoxLayout:
                    orientation: "vertical"
                    MainActionBar:
                    BoxLayout:
                        id: aphorism_container
                        orientation: "vertical"
                        AphorismWidget:
                    Button:
                        size_hint_y: '0.05sp'
                        text: 'random'
                        on_press: root.aphorism_display_random()
            Screen:
                name: 'Search'
                orientation: "vertical"
                BoxLayout:
                    orientation: "vertical"
                    MainActionBar:
                    SearchForm:
            Screen:
                name: 'List'
                BoxLayout:
                    orientation: "vertical"
                    MainActionBar:
                    BoxLayout:
                        orientation: "vertical"
                        size_hint_y: '0.1sp'
                        RelativeLayout:
            Screen:
                name: 'Add'
                BoxLayout:
                    orientation: "vertical"
                    MainActionBar:
                    BoxLayout:
                        orientation: "vertical"
                        size_hint_y: '0.1sp'
                        RelativeLayout:
                        Button:
                            id: 'Add'
                            text: 'Add'
            Screen:
                name: 'Edit'
                BoxLayout:
                    orientation: "vertical"
                    MainActionBar:
                    BoxLayout:
                        orientation: "vertical"
                        size_hint_y: '0.1sp'
                        RelativeLayout:
                        Button:
                            id: 'Edit'
                            text: 'Edit'
    AnchorLayout:
        anchor_x: 'center'
        anchor_y: 'bottom'
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: '0.05sp'
            Button:
                text: 'Main'
                on_press: Screens.current = 'Main'
            Button:
                text: 'Search'
                on_press: Screens.current = 'Search'
            Button:
                text: 'List'
                on_press: Screens.current = 'List'
            Button:
                text: 'Add'
                on_press: Screens.current = 'Add'
            Button:
                text: 'Edit'
                on_press: Screens.current = 'Edit'

<AboutWidget>:
    auto_dismiss: False
    size_hint: .75, .75
    title: 'About Aforgizmo'
    BoxLayout:
        orientation: "vertical"
        padding: 2
        spacing: 10
        Label:
            text_size: self.width, None
            markup: True
            text: 'This app was written by [b]Vijay Mahrra[/b].\n\n[i]http://about.me/vijay.mahrra[/i]\n\nComments, issues and feedback to: [b]vijay.mahrra@gmail.com[/b]\n\n'
        Button:
            text: 'OK'
            on_press: root.dismiss()

<HelpWidget>:
    auto_dismiss: False
    size_hint: .75, .75
    title: 'Aforgizmo Help'
    BoxLayout:
        orientation: "vertical"
        padding: 2
        spacing: 10
        Label:
            size_hint_y: None
            text_size: self.width, None
            markup: True
            text: 'No help available yet!'
        Button:
            text: 'OK'
            on_press: root.dismiss()
